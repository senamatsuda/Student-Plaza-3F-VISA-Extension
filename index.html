<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>在留期間更新 必要書類ナビ</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, -apple-system, sans-serif; margin: 2rem; line-height: 1.6; background: #f6f7fb; }
    h1 { font-size: 1.6rem; margin-bottom: 0.2rem; }
    .card { max-width: 1500px; padding: 1.5rem 1.75rem; border: 1px solid #e2e2e2; border-radius: 14px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05); background: #fff; }
    label { display: block; font-weight: 600; margin-top: 1rem; margin-bottom: 0.35rem; }
    select { width: 100%; padding: 0.55rem; font-size: 1rem; border-radius: 8px; border: 1px solid #c6c6c6; background: #fff; }
    button { margin-top: 1.1rem; padding: 0.7rem 1.05rem; font-size: 1rem; border-radius: 10px; border: 0; background: #0069d9; color: #fff; cursor: pointer; box-shadow: 0 3px 10px rgba(0, 105, 217, 0.2); }
    button:disabled { background: #9ab9e8; cursor: not-allowed; box-shadow: none; }
    ul { padding-left: 1.1rem; }
    .muted { color: #555; }
    fieldset { border: 0; padding: 0; margin: 0; }
    .scenario-fieldset legend { font-weight: 600; margin-bottom: 0.35rem; font-size: 1rem; }
    .scenario-fieldset .helper { margin-top: 0; }
    .scenario-options { display: flex; flex-direction: column; gap: 0.4rem; }
    .scenario-option { border: 1px solid #d6d6d6; border-radius: 10px; padding: 0.55rem 0.65rem; display: flex; gap: 0.55rem; align-items: flex-start; background: #f8fafc; cursor: pointer; transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease; }
    .scenario-option.selected { border-color: #0069d9; background: #e7f0ff; box-shadow: 0 6px 18px rgba(0, 105, 217, 0.08); }
    .scenario-option input { margin-top: 0.2rem; }
    .scenario-option:hover { border-color: #9ab9e8; background: #f0f4ff; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.04); }
    .selection-summary { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.35rem; }
    .chips { display: flex; gap: 0.35rem; flex-wrap: wrap; }
    .chip { background: #eef2ff; border: 1px solid #d6defa; border-radius: 999px; padding: 0.22rem 0.6rem; display: inline-flex; gap: 0.35rem; align-items: center; }
    .chip-remove { border: none; background: none; cursor: pointer; font-size: 0.9rem; line-height: 1; color: #555; padding: 0; margin: 0; }
    .chip-remove:hover { color: #000; }
    .clear-selection { border: none; background: none; color: #0069d9; cursor: pointer; font-size: 0.9rem; padding: 0; margin-top: 0; border-radius: 0; box-shadow: none; }
    .clear-selection:hover { text-decoration: underline; }
    .helper { font-size: 0.95rem; }
    .hint { font-size: 0.95rem; margin-top: 0.6rem; color: #333; }
    .hidden { display: none; }
    .options h3 { font-size: 1rem; margin: 0 0 0.35rem; }
    .options label { font-weight: 500; display: flex; gap: 0.45rem; align-items: center; margin-top: 0.35rem; }
    .toolbar { display: flex; justify-content: flex-end; margin-bottom: 1rem; position: relative; gap: 0.5rem; }
    .language-button { padding: 0.55rem 0.9rem; border-radius: 10px; border: 1px solid #c6c6c6; background: #fff; color: #000; cursor: pointer; font-size: 0.95rem; display: inline-flex; align-items: center; gap: 0.35rem; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05); }
    .language-menu { position: absolute; top: 110%; right: 0; background: #fff; border: 1px solid #e2e2e2; border-radius: 10px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08); padding: 0.35rem; min-width: 160px; z-index: 2; }
    .language-menu button { width: 100%; padding: 0.55rem 0.75rem; border: 0; background: transparent; text-align: left; border-radius: 8px; cursor: pointer; font-size: 0.95rem; color: #000; }
    .language-menu button:hover { background: #f0f4ff; }
    .badge { background: #eef2ff; color: #333; padding: 0.15rem 0.45rem; border-radius: 999px; font-size: 0.8rem; margin-left: 0.35rem; }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="language-button" class="language-button" aria-haspopup="true" aria-expanded="false">言語</button>
    <div id="language-menu" class="language-menu hidden">
      <button data-lang="ja">日本語</button>
      <button data-lang="en">English</button>
      <button data-lang="zh">中文</button>
    </div>
  </div>
  <div class="card">
    <h1>在留期間更新に必要な書類</h1>
    <p class="muted" id="template-link-text">各種テンプレートは以下のリンクから入手してください。</p>
    <p class="muted"><a id="template-link-anchor" href="https://momiji.hiroshima-u.ac.jp/momiji-top/international/zairyukikan.html" target="_blank" rel="noopener noreferrer">https://momiji.hiroshima-u.ac.jp/momiji-top/international/zairyukikan.html</a></p>
    <p class="muted description">身分・状況・奨学金区分を選ぶと、提出が必要な書類が表示されます。<br>該当する追加条件があればチェックしてください。</p>

    <label for="status">身分</label>
    <select id="status">
      <option value="">選択してください</option>
    </select>

    <fieldset class="scenario-fieldset" aria-labelledby="scenario-label">
      <legend id="scenario-label">状況（複数選択可）[今持っている在留カードに記載されている期間内に当てはまるもの全て選択してください]</legend>
      <p id="scenario-helper" class="muted helper">チェックボックスで状況を選択してください（複数選択できます）</p>
      <div id="scenario-placeholder" class="muted">身分を先に選んでください</div>
      <div id="scenario-options" class="scenario-options"></div>
      <div id="scenario-selection" class="selection-summary hidden">
        <span class="muted" id="scenario-selection-label">選択中</span>
        <div id="scenario-chips" class="chips"></div>
        <button type="button" id="clear-scenarios" class="clear-selection">すべて解除</button>
      </div>
    </fieldset>

    <div id="options" class="options"></div>

    <label for="scholarship">奨学金区分（任意）</label>
    <select id="scholarship">
      <option value="">選択なし</option>
    </select>

    <div id="scholarship-status-group" class="hidden">
      <label for="scholarship-status">奨学金の状況（任意）<span class="badge">任意</span></label>
      <select id="scholarship-status" disabled>
        <option value="">奨学金区分を先に選んでください</option>
      </select>
    </div>

    <div class="hint">「日本政府以外の奨学金受給学生」を選んだ場合のみ、奨学金の状況に応じた必要書類が表示されます。</div>

    <button id="show" disabled>必要書類を表示</button>

    <div id="results" style="margin-top: 1.4rem;"></div>
  </div>

  <script src="lang/en.js"></script>
  <script src="lang/zh.js"></script>
  <script>
    const COMMON_REQUIREMENTS = [
      "在留期間更新許可申請書（申請人等作成用の3枚 + 所属機関等作成用の2枚）",
      "提出書類一覧表、各種類確認書（両方提出必須。2025年1月申請分から提出が必須）",
      "パスポート、在留カード（原本を持参・提示してください）",
      "6,000円分の収入印紙",
    ];

    const STATUS_DATA = {
      "正規生": [
        {
          label: "前学期も同じ身分で正規生として在籍",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行機で発行）",
          ],
        },
        {
          label: "前学期とは異なる身分で正規生として在籍（学部生→修士、修士→博士等）",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、研究生として在籍",
          requirements: [
            "在学証明書（証明書自動発行機で発行）",
            "外国人研究生証明書(別紙様式５)（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
      ],
      "研究生": [
        {
          label: "前学期も研究生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、3+1特別聴講生(C)として在籍（9月で在留期限が切れる場合）",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（3+1プログラムの成績）",
          ],
        },
        {
          label: "前学期、正規生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（旧所属の支援室で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
      ],
      "特別聴講学生": [
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、本学の特別聴講生として在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（所属の支援室で発行）",
          ],
        },
      ],
    };

    const STATUS_OPTIONAL_DATA = {
      "正規生": [
        {
          label: "標準修業年限を超えて研究する",
          requirements: [
            "理由書(延長期間・理由を指導教員に記入してもらい、提出)(用紙は所属の支援室・留学交流グループにあります)",
          ],
        },
        {
          label: "これから進学予定",
          requirements: ["合格通知書(コピー)"],
        },
      ],
      "研究生": [
        {
          label: "1年以上研究生を続けている",
          requirements: ["「外国人研究生について」の書類(所属の支援室に依頼)"],
        },
        {
          label: "大学院進学予定",
          requirements: ["合格通知書(コピー)"],
        },
        {
          label: "研究継続予定",
          requirements: ["研究継続許可書(コピー)"],
        },
      ],
    };

    const SCENARIO_OPTIONAL_DATA = {
      "研究生": {
        "前学期、3+1特別聴講生(C)として在籍（9月で在留期限が切れる場合）": [
          { label: "これから研究生になる方", requirements: ["外国人研究生 許可書(コピー)"] },
          { label: "修士に進学する方", requirements: ["合格通知書(コピー)"] },
        ],
      },
      "特別聴講学生": {
        "前学期、他大学に在籍": [
          { label: "日本の大学に１年以上在籍", requirements: ["理由書(本学と本人からの両方を１枚に)"] },
        ],
        "前学期、本学の特別聴講生として在籍": [
          { label: "本学に１年以上在籍", requirements: ["理由書(本学と本人からの両方を１枚に)"] },
        ],
      },
    };

    const SCHOLARSHIP_DATA = {
      "国費留学生": ["日本政府奨学金受給証明書（留学交流グループで発行）"],
      "日韓共同理工系学部留学生": ["日韓共同理工系学部留学生奨学金証明書（留学交流グループで発行）"],
      "日本政府以外の給付型の奨学金受給学生": ["奨学金証明書（コピー）"],
      "日本政府以外の貸与型の奨学金受給学生": ["留学生の母国語および日本語で作成された契約書等"],
    };

    const SCHOLARSHIP_STATUS_DATA = {
      "前回申請以降に新たに奨学金を受給": [
        "奨学金決定通知書（財団等が発行。作成できない場合は大学が発行した証明書）",
        "通帳の写し（奨学金の入金が確認できるページ）",
      ],
      "前回申請時に奨学金証明書を提出済み": [
        "通帳の写し（奨学金の入金が確認できるページ）",
      ],
    };

    const NON_GOV_SCHOLARSHIPS = [
      "日本政府以外の給付型の奨学金受給学生",
      "日本政府以外の貸与型の奨学金受給学生",
    ];

    const TRANSLATIONS = {
      ja: {},
      en: window.TRANSLATIONS_EN || {},
      zh: window.TRANSLATIONS_ZH || {},
    };

    let currentLang = 'ja';

    const statusSelect = document.getElementById('status');
    const scenarioOptionsContainer = document.getElementById('scenario-options');
    const scenarioPlaceholder = document.getElementById('scenario-placeholder');
    const scenarioSelection = document.getElementById('scenario-selection');
    const scenarioSelectionLabel = document.getElementById('scenario-selection-label');
    const scenarioChips = document.getElementById('scenario-chips');
    const clearScenariosButton = document.getElementById('clear-scenarios');
    const scholarshipSelect = document.getElementById('scholarship');
    const scholarshipStatusGroup = document.getElementById('scholarship-status-group');
    const scholarshipStatusSelect = document.getElementById('scholarship-status');
    const showButton = document.getElementById('show');
    const results = document.getElementById('results');
    const optionsContainer = document.getElementById('options');
    const heading = document.querySelector('h1');
    const templateLinkText = document.getElementById('template-link-text');
    const templateLinkAnchor = document.getElementById('template-link-anchor');
    const description = document.querySelector('.description');
    const statusLabel = document.querySelector('label[for="status"]');
    const scenarioLabel = document.getElementById('scenario-label');
    const scholarshipLabel = document.querySelector('label[for="scholarship"]');
    const scholarshipStatusLabel = document.querySelector('label[for="scholarship-status"]');
    const hint = document.querySelector('.hint');
    const scenarioHelper = document.getElementById('scenario-helper');
    const languageButton = document.getElementById('language-button');
    const languageMenu = document.getElementById('language-menu');

    function t(text) {
      if (!text) return '';
      if (currentLang === 'ja') return text;
      return (TRANSLATIONS[currentLang] && TRANSLATIONS[currentLang][text]) || text;
    }

    function updateLanguageButtonLabel() {
      const labels = { ja: '日本語', en: 'English', zh: '中文' };
      languageButton.textContent = `${t('言語')}: ${labels[currentLang]}`;
      languageButton.setAttribute('aria-expanded', 'false');
    }

    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      languageMenu.classList.add('hidden');
      applyLanguage();
    }

    languageButton.addEventListener('click', (event) => {
      event.stopPropagation();
      const isOpen = !languageMenu.classList.contains('hidden');
      languageMenu.classList.toggle('hidden');
      languageButton.setAttribute('aria-expanded', String(!isOpen));
    });

    languageMenu.addEventListener('click', (event) => {
      const lang = event.target.dataset ? event.target.dataset.lang : null;
      if (lang) {
        setLanguage(lang);
      }
    });

    document.addEventListener('click', (event) => {
      if (!languageMenu.contains(event.target) && event.target !== languageButton) {
        languageMenu.classList.add('hidden');
        languageButton.setAttribute('aria-expanded', 'false');
      }
    });

    function populateStatuses(preserveSelection = true) {
      const current = preserveSelection ? statusSelect.value : '';
      statusSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = t('選択してください');
      statusSelect.appendChild(placeholder);

      Object.keys(STATUS_DATA).forEach((status) => {
        const option = document.createElement('option');
        option.value = status;
        option.textContent = t(status);
        if (current === status) option.selected = true;
        statusSelect.appendChild(option);
      });
    }

    function populateScholarships(preserveSelection = true) {
      const current = preserveSelection ? scholarshipSelect.value : '';
      scholarshipSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = t('選択なし');
      scholarshipSelect.appendChild(placeholder);

      Object.keys(SCHOLARSHIP_DATA).forEach((key) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = t(key);
        if (current === key) option.selected = true;
        scholarshipSelect.appendChild(option);
      });
    }

    function populateScholarshipStatuses(preserveSelection = true) {
      const current = preserveSelection ? scholarshipStatusSelect.value : '';
      scholarshipStatusSelect.innerHTML = '';

      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = t('奨学金区分を先に選んでください');
      placeholder.disabled = false;
      scholarshipStatusSelect.appendChild(placeholder);

      Object.keys(SCHOLARSHIP_STATUS_DATA).forEach((key) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = t(key);
        if (current === key) option.selected = true;
        scholarshipStatusSelect.appendChild(option);
      });
    }

    function getSelectedScenarios() {
      return Array.from(
        scenarioOptionsContainer.querySelectorAll('input[type="checkbox"]:checked')
      ).map((checkbox) => checkbox.value);
    }

    function renderScenarioSelection() {
      const selected = getSelectedScenarios();
      scenarioSelection.classList.toggle('hidden', !selected.length);
      scenarioChips.innerHTML = '';

      selected.forEach((value) => {
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.textContent = t(value);

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'chip-remove';
        removeBtn.setAttribute('aria-label', `${t('この状況を外す')}: ${t(value)}`);
        removeBtn.title = t('この状況を外す');
        removeBtn.textContent = '×';
        removeBtn.addEventListener('click', () => {
          const checkbox = Array.from(
            scenarioOptionsContainer.querySelectorAll('input[type="checkbox"]')
          ).find((input) => input.value === value);
          if (checkbox) {
            checkbox.checked = false;
            const wrapper = checkbox.closest('.scenario-option');
            if (wrapper) wrapper.classList.remove('selected');
            handleScenarioChange();
          }
        });

        chip.appendChild(removeBtn);
        scenarioChips.appendChild(chip);
      });
    }

    function handleScenarioChange() {
      showButton.disabled = !getSelectedScenarios().length;
      renderOptions();
      renderScenarioSelection();
      showRequirements();
    }

    function renderOptions() {
      optionsContainer.innerHTML = '';
      const status = statusSelect.value;
      if (!status) return;

      const optionItems = [];
      if (STATUS_OPTIONAL_DATA[status]) {
        optionItems.push(...STATUS_OPTIONAL_DATA[status]);
      }

      const scenarioLabels = getSelectedScenarios();
      scenarioLabels.forEach((scenarioLabel) => {
        if (
          SCENARIO_OPTIONAL_DATA[status] &&
          SCENARIO_OPTIONAL_DATA[status][scenarioLabel]
        ) {
          optionItems.push(...SCENARIO_OPTIONAL_DATA[status][scenarioLabel]);
        }
      });

      if (!optionItems.length) return;

      const wrapper = document.createElement('div');
      const headingEl = document.createElement('h3');
      headingEl.textContent = t('該当する場合はチェックを入れてください');
      wrapper.appendChild(headingEl);

      optionItems.forEach((item, idx) => {
        const label = document.createElement('label');
        label.htmlFor = `option-${idx}`;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `option-${idx}`;
        checkbox.dataset.requirements = JSON.stringify(item.requirements || []);
        checkbox.addEventListener('change', showRequirements);

        const text = document.createElement('span');
        text.textContent = t(item.label);

        label.appendChild(checkbox);
        label.appendChild(text);
        wrapper.appendChild(label);
      });

      optionsContainer.appendChild(wrapper);
    }

    function refreshScenarios(preserveSelection = true) {
      const status = statusSelect.value;
      const selectedValues = preserveSelection ? getSelectedScenarios() : [];
      scenarioOptionsContainer.innerHTML = '';
      scenarioPlaceholder.classList.add('hidden');
      if (!status) {
        scenarioPlaceholder.textContent = t('身分を先に選んでください');
        scenarioPlaceholder.classList.remove('hidden');
        showButton.disabled = true;
        renderOptions();
        renderScenarioSelection();
        return;
      }

      STATUS_DATA[status].forEach((scenario, idx) => {
        const label = document.createElement('label');
        label.className = 'scenario-option';
        label.htmlFor = `scenario-${idx}`;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `scenario-${idx}`;
        checkbox.value = scenario.label;
        checkbox.checked = selectedValues.includes(scenario.label);
        if (checkbox.checked) label.classList.add('selected');
        checkbox.addEventListener('change', () => {
          label.classList.toggle('selected', checkbox.checked);
          handleScenarioChange();
        });

        const text = document.createElement('span');
        text.textContent = t(scenario.label);

        label.appendChild(checkbox);
        label.appendChild(text);
        scenarioOptionsContainer.appendChild(label);
      });

      handleScenarioChange();
    }

    function renderRequirements(requirements, scholarshipStatus) {
      results.innerHTML = '';
      if (!requirements.length) {
        const empty = document.createElement('p');
        empty.textContent = t('必要な書類はありません。');
        results.appendChild(empty);
        return;
      }

      const list = document.createElement('ul');
      requirements.forEach((item) => {
        const li = document.createElement('li');
        li.textContent = t(item);
        list.appendChild(li);
      });
      results.appendChild(list);

      if (scholarshipStatus) {
        const statusNote = document.createElement('p');
        statusNote.className = 'muted';
        statusNote.textContent = `${t('奨学金の状況:')} ${t(scholarshipStatus)}`;
        results.appendChild(statusNote);
      }
    }

    function getSelectedOptionalRequirements() {
      const checkboxes = optionsContainer.querySelectorAll('input[type="checkbox"]:checked');
      return Array.from(checkboxes).flatMap((checkbox) => {
        try {
          return JSON.parse(checkbox.dataset.requirements || '[]');
        } catch (err) {
          return [];
        }
      });
    }

    function showRequirements() {
      const status = statusSelect.value;
      const selectedScenarios = getSelectedScenarios();
      const scholarship = scholarshipSelect.value;
      const scholarshipStatus = NON_GOV_SCHOLARSHIPS.includes(scholarship)
        ? scholarshipStatusSelect.value
        : '';
      if (!status || !selectedScenarios.length) {
        renderRequirements([], scholarshipStatus);
        return;
      }

      const optionalRequirements = getSelectedOptionalRequirements();
      const scenarioRequirements = selectedScenarios.flatMap((label) => {
        const scenario = STATUS_DATA[status].find((item) => item.label === label);
        return scenario ? scenario.requirements : [];
      });

      const combined = [
        ...COMMON_REQUIREMENTS,
        ...scenarioRequirements,
        ...optionalRequirements,
        ...(scholarship ? SCHOLARSHIP_DATA[scholarship] || [] : []),
        ...(scholarshipStatus ? SCHOLARSHIP_STATUS_DATA[scholarshipStatus] || [] : []),
      ];

      const uniqueRequirements = Array.from(new Set(combined));
      renderRequirements(uniqueRequirements, scholarshipStatus);
    }

    statusSelect.addEventListener('change', () => {
      refreshScenarios();
      showRequirements();
    });

    clearScenariosButton.addEventListener('click', () => {
      scenarioOptionsContainer
        .querySelectorAll('input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.checked = false;
          const wrapper = checkbox.closest('.scenario-option');
          if (wrapper) wrapper.classList.remove('selected');
        });
      handleScenarioChange();
    });

    scholarshipSelect.addEventListener('change', () => {
      const isNonGov = NON_GOV_SCHOLARSHIPS.includes(scholarshipSelect.value);
      if (!scholarshipSelect.value) {
        scholarshipStatusGroup.classList.add('hidden');
        scholarshipStatusSelect.value = '';
        scholarshipStatusSelect.disabled = true;
        scholarshipStatusSelect.options[0].textContent = t('奨学金区分を先に選んでください');
      } else if (isNonGov) {
        scholarshipStatusGroup.classList.remove('hidden');
        scholarshipStatusSelect.disabled = false;
        scholarshipStatusSelect.options[0].textContent = t('奨学金の状況を選択してください');
      } else {
        scholarshipStatusGroup.classList.add('hidden');
        scholarshipStatusSelect.value = '';
        scholarshipStatusSelect.disabled = true;
        scholarshipStatusSelect.options[0].textContent = t('奨学金区分を先に選んでください');
      }
      showRequirements();
    });
    scholarshipStatusSelect.addEventListener('change', showRequirements);
    showButton.addEventListener('click', showRequirements);

    function applyLanguage() {
      document.title = t('在留期間更新 必要書類ナビ');
      heading.textContent = t('在留期間更新に必要な書類');
      templateLinkText.textContent = t('各種テンプレートは以下のリンクから入手してください。');
      templateLinkAnchor.textContent = templateLinkAnchor.href;
      description.innerHTML = `${t('身分・状況・奨学金区分を選ぶと、提出が必要な書類が表示されます。')}<br>${t('該当する追加条件があればチェックしてください。')}`;
      statusLabel.textContent = t('身分');
      scenarioLabel.textContent = t('状況（複数選択可）');
      scenarioHelper.textContent = t('チェックボックスで状況を選択してください（複数選択できます）');
      scenarioSelectionLabel.textContent = t('選択中');
      clearScenariosButton.textContent = t('すべて解除');
      scenarioPlaceholder.textContent = t('身分を先に選んでください');
      scholarshipLabel.textContent = t('奨学金区分（任意）');
      scholarshipStatusLabel.innerHTML = `${t('奨学金の状況（任意）')}<span class="badge">${t('任意')}</span>`;
      hint.textContent = t('「日本政府以外の奨学金受給学生」を選んだ場合のみ、奨学金の状況に応じた必要書類が表示されます。');
      showButton.textContent = t('必要書類を表示');
      populateStatuses();
      populateScholarships();
      populateScholarshipStatuses();
      refreshScenarios();
      renderOptions();
      showRequirements();
      updateLanguageButtonLabel();
    }

    populateStatuses(false);
    populateScholarships(false);
    populateScholarshipStatuses(false);
    refreshScenarios(false);
    applyLanguage();
  </script>
</body>
</html>
