<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>在留期間更新 必要書類ナビ</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, -apple-system, sans-serif; margin: 2rem; line-height: 1.6; background: #f6f7fb; }
    h1 { font-size: 1.6rem; margin-bottom: 0.2rem; }
    .card { max-width: 820px; padding: 1.5rem 1.75rem; border: 1px solid #e2e2e2; border-radius: 14px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05); background: #fff; }
    label { display: block; font-weight: 600; margin-top: 1rem; margin-bottom: 0.35rem; }
    select { width: 100%; padding: 0.55rem; font-size: 1rem; border-radius: 8px; border: 1px solid #c6c6c6; background: #fff; }
    button { margin-top: 1.1rem; padding: 0.7rem 1.05rem; font-size: 1rem; border-radius: 10px; border: 0; background: #0069d9; color: #fff; cursor: pointer; box-shadow: 0 3px 10px rgba(0, 105, 217, 0.2); }
    button:disabled { background: #9ab9e8; cursor: not-allowed; box-shadow: none; }
    ul { padding-left: 1.1rem; }
    .muted { color: #555; }
    .hint { font-size: 0.95rem; margin-top: 0.6rem; color: #333; }
    .hidden { display: none; }
    .options h3 { font-size: 1rem; margin: 0 0 0.35rem; }
    .options label { font-weight: 500; display: flex; gap: 0.45rem; align-items: center; margin-top: 0.35rem; }
  </style>
</head>
<body>
  <div class="card">
    <h1>在留期間更新に必要な書類</h1>
    <p class="muted">身分・状況・奨学金区分を選ぶと、提出が必要な書類が表示されます。<br>該当する追加条件があればチェックしてください。</p>

    <label for="status">身分</label>
    <select id="status">
      <option value="">選択してください</option>
    </select>

    <label for="scenario">状況（複数選択可）</label>
    <select id="scenario" multiple disabled size="6">
    </select>

    <div id="options" class="options"></div>

    <label for="scholarship">奨学金区分（任意）</label>
    <select id="scholarship">
      <option value="">選択なし</option>
    </select>

    <div id="scholarship-status-group" class="hidden">
      <label for="scholarship-status">奨学金の状況（任意）<span class="badge">任意</span></label>
      <select id="scholarship-status" disabled>
        <option value="">奨学金区分を先に選んでください</option>
      </select>
    </div>

    <div class="hint">「日本政府以外の奨学金受給学生」を選んだ場合のみ、奨学金の状況に応じた必要書類が表示されます。</div>

    <button id="show" disabled>必要書類を表示</button>

    <div id="results" style="margin-top: 1.4rem;"></div>
  </div>

  <script>
    const COMMON_REQUIREMENTS = [
      "在留期間更新許可申請書（申請人等作成用の3枚 + 所属機関等作成用の2枚）",
      "提出書類一覧表、各種類確認書（両方提出必須。2025年1月申請分から提出が必須）",
      "パスポート、在留カード（原本を持参・提示してください）",
      "6,000円分の収入印紙",
    ];

    const STATUS_DATA = {
      "正規生": [
        {
          label: "前学期も同じ身分で正規生として在籍",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行機で発行）",
          ],
        },
        {
          label: "前学期とは異なる身分で正規生として在籍（学部生→修士、修士→博士等）",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、研究生として在籍",
          requirements: [
            "在学証明書（証明書自動発行機で発行）",
            "外国人研究生証明書(別紙様式５)（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
      ],
      "研究生": [
        {
          label: "前学期も研究生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、3+1特別聴講生(C)として在籍（9月で在留期限が切れる場合）",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（3+1プログラムの成績）",
          ],
        },
        {
          label: "前学期、正規生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（旧所属の支援室で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
      ],
      "特別聴講学生": [
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、本学の特別聴講生として在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（所属の支援室で発行）",
          ],
        },
      ],
    };

    const STATUS_OPTIONAL_DATA = {
      "正規生": [
        {
          label: "標準修業年限を超えて研究する",
          requirements: [
            "理由書(延長期間・理由を指導教員に記入してもらい、提出)(用紙は所属の支援室・留学交流グループにあります)",
          ],
        },
        {
          label: "これから進学予定",
          requirements: ["合格通知書(コピー)"],
        },
      ],
      "研究生": [
        {
          label: "1年以上研究生を続けている",
          requirements: ["「外国人研究生について」の書類(所属の支援室に依頼)"],
        },
        {
          label: "大学院進学予定",
          requirements: ["合格通知書(コピー)"],
        },
        {
          label: "研究継続予定",
          requirements: ["研究継続許可書(コピー)"],
        },
      ],
    };

    const SCENARIO_OPTIONAL_DATA = {
      "研究生": {
        "前学期、3+1特別聴講生(C)として在籍（9月で在留期限が切れる場合）": [
          { label: "これから研究生になる方", requirements: ["外国人研究生 許可書(コピー)"] },
          { label: "修士に進学する方", requirements: ["合格通知書(コピー)"] },
        ],
      },
      "特別聴講学生": {
        "前学期、他大学に在籍": [
          { label: "日本の大学に１年以上在籍", requirements: ["理由書(本学と本人からの両方を１枚に)"] },
          { label: "本学に１年以上在籍", requirements: ["理由書(本学と本人からの両方を１枚に)"] },
        ],
      },
    };

    const SCHOLARSHIP_DATA = {
      "国費留学生": ["日本政府奨学金受給証明書（留学交流グループで発行）"],
      "日韓共同理工系学部留学生": ["日韓共同理工系学部留学生奨学金証明書（留学交流グループで発行）"],
      "日本政府以外の給付型の奨学金受給学生": ["奨学金証明書（コピー）"],
      "日本政府以外の貸与型の奨学金受給学生": ["留学生の母国語および日本語で作成された契約書等"],
    };

    const SCHOLARSHIP_STATUS_DATA = {
      "前回申請以降に新たに奨学金を受給": [
        "奨学金決定通知書（財団等が発行。作成できない場合は大学が発行した証明書）",
        "通帳の写し（奨学金の入金が確認できるページ）",
      ],
      "前回申請時に奨学金証明書を提出済み": [
        "通帳の写し（奨学金の入金が確認できるページ）",
      ],
    };

    const NON_GOV_SCHOLARSHIPS = [
      "日本政府以外の給付型の奨学金受給学生",
      "日本政府以外の貸与型の奨学金受給学生",
    ];

    const statusSelect = document.getElementById('status');
    const scenarioSelect = document.getElementById('scenario');
    const scholarshipSelect = document.getElementById('scholarship');
    const scholarshipStatusGroup = document.getElementById('scholarship-status-group');
    const scholarshipStatusSelect = document.getElementById('scholarship-status');
    const showButton = document.getElementById('show');
    const results = document.getElementById('results');
    const optionsContainer = document.getElementById('options');

    function populateStatuses() {
      Object.keys(STATUS_DATA).forEach((status) => {
        const option = document.createElement('option');
        option.value = status;
        option.textContent = status;
        statusSelect.appendChild(option);
      });
    }

    function populateScholarships() {
      Object.keys(SCHOLARSHIP_DATA).forEach((key) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        scholarshipSelect.appendChild(option);
      });
    }

    function populateScholarshipStatuses() {
      Object.keys(SCHOLARSHIP_STATUS_DATA).forEach((key) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        scholarshipStatusSelect.appendChild(option);
      });
    }

    function getSelectedScenarios() {
      return Array.from(scenarioSelect.selectedOptions).map((opt) => opt.value);
    }

    function renderOptions() {
      optionsContainer.innerHTML = '';
      const status = statusSelect.value;
      if (!status) return;

      const optionItems = [];
      if (STATUS_OPTIONAL_DATA[status]) {
        optionItems.push(...STATUS_OPTIONAL_DATA[status]);
      }

      const scenarioLabels = getSelectedScenarios();
      scenarioLabels.forEach((scenarioLabel) => {
        if (
          SCENARIO_OPTIONAL_DATA[status] &&
          SCENARIO_OPTIONAL_DATA[status][scenarioLabel]
        ) {
          optionItems.push(...SCENARIO_OPTIONAL_DATA[status][scenarioLabel]);
        }
      });

      if (!optionItems.length) return;

      const wrapper = document.createElement('div');
      const heading = document.createElement('h3');
      heading.textContent = '該当する場合はチェックを入れてください';
      wrapper.appendChild(heading);

      optionItems.forEach((item, idx) => {
        const label = document.createElement('label');
        label.htmlFor = `option-${idx}`;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `option-${idx}`;
        checkbox.dataset.requirements = JSON.stringify(item.requirements || []);
        checkbox.addEventListener('change', showRequirements);

        const text = document.createElement('span');
        text.textContent = item.label;

        label.appendChild(checkbox);
        label.appendChild(text);
        wrapper.appendChild(label);
      });

      optionsContainer.appendChild(wrapper);
    }

    function refreshScenarios() {
      const status = statusSelect.value;
      scenarioSelect.innerHTML = '';
      if (!status) {
        const option = document.createElement('option');
        option.value = '';
        option.textContent = '身分を先に選んでください';
        option.disabled = true;
        scenarioSelect.appendChild(option);
        scenarioSelect.disabled = true;
        showButton.disabled = true;
        renderOptions();
        return;
      }

      STATUS_DATA[status].forEach((scenario) => {
        const option = document.createElement('option');
        option.value = scenario.label;
        option.textContent = scenario.label;
        scenarioSelect.appendChild(option);
      });

      scenarioSelect.disabled = false;
      showButton.disabled = !getSelectedScenarios().length;
      renderOptions();
    }

    function renderRequirements(requirements, scholarshipStatus) {
      results.innerHTML = '';
      if (!requirements.length) {
        const empty = document.createElement('p');
        empty.textContent = '必要な書類はありません。';
        results.appendChild(empty);
        return;
      }

      const list = document.createElement('ul');
      requirements.forEach((item) => {
        const li = document.createElement('li');
        li.textContent = item;
        list.appendChild(li);
      });
      results.appendChild(list);

      if (scholarshipStatus) {
        const statusNote = document.createElement('p');
        statusNote.className = 'muted';
        statusNote.textContent = `奨学金の状況: ${scholarshipStatus}`;
        results.appendChild(statusNote);
      }
    }

    function getSelectedOptionalRequirements() {
      const checkboxes = optionsContainer.querySelectorAll('input[type="checkbox"]:checked');
      return Array.from(checkboxes).flatMap((checkbox) => {
        try {
          return JSON.parse(checkbox.dataset.requirements || '[]');
        } catch (err) {
          return [];
        }
      });
    }

    function showRequirements() {
      const status = statusSelect.value;
      const selectedScenarios = getSelectedScenarios();
      const scholarship = scholarshipSelect.value;
      const scholarshipStatus = NON_GOV_SCHOLARSHIPS.includes(scholarship)
        ? scholarshipStatusSelect.value
        : '';
      if (!status || !selectedScenarios.length) {
        renderRequirements([], scholarshipStatus);
        return;
      }

      const optionalRequirements = getSelectedOptionalRequirements();
      const scenarioRequirements = selectedScenarios.flatMap((label) => {
        const scenario = STATUS_DATA[status].find((item) => item.label === label);
        return scenario ? scenario.requirements : [];
      });

      const combined = [
        ...COMMON_REQUIREMENTS,
        ...scenarioRequirements,
        ...optionalRequirements,
        ...(scholarship ? SCHOLARSHIP_DATA[scholarship] || [] : []),
        ...(scholarshipStatus ? SCHOLARSHIP_STATUS_DATA[scholarshipStatus] || [] : []),
      ];

      const uniqueRequirements = Array.from(new Set(combined));
      renderRequirements(uniqueRequirements, scholarshipStatus);
    }

    statusSelect.addEventListener('change', () => {
      refreshScenarios();
      showRequirements();
    });

    scenarioSelect.addEventListener('change', () => {
      showButton.disabled = !getSelectedScenarios().length;
      renderOptions();
      showRequirements();
    });

    scholarshipSelect.addEventListener('change', showRequirements);
    scholarshipSelect.addEventListener('change', () => {
      const isNonGov = NON_GOV_SCHOLARSHIPS.includes(scholarshipSelect.value);
      if (!scholarshipSelect.value) {
        scholarshipStatusGroup.classList.add('hidden');
        scholarshipStatusSelect.value = '';
        scholarshipStatusSelect.disabled = true;
        scholarshipStatusSelect.options[0].textContent = '奨学金区分を先に選んでください';
      } else if (isNonGov) {
        scholarshipStatusGroup.classList.remove('hidden');
        scholarshipStatusSelect.disabled = false;
        scholarshipStatusSelect.options[0].textContent = '奨学金の状況を選択してください';
      } else {
        scholarshipStatusGroup.classList.add('hidden');
        scholarshipStatusSelect.value = '';
        scholarshipStatusSelect.disabled = true;
        scholarshipStatusSelect.options[0].textContent = '奨学金区分を先に選んでください';
      }
    });
    scholarshipStatusSelect.addEventListener('change', showRequirements);
    showButton.addEventListener('click', showRequirements);

    populateStatuses();
    populateScholarships();
    populateScholarshipStatuses();
  </script>
</body>
</html>
