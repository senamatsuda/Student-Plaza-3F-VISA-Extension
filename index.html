<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>在留期間更新 必要書類ナビ</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, -apple-system, sans-serif; margin: 2rem; line-height: 1.6; background: #f6f7fb; }
    h1 { font-size: 1.6rem; margin-bottom: 0.2rem; }
    .card { max-width: 820px; padding: 1.5rem 1.75rem; border: 1px solid #e2e2e2; border-radius: 14px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05); background: #fff; }
    label { display: block; font-weight: 600; margin-top: 1rem; margin-bottom: 0.35rem; }
    select { width: 100%; padding: 0.55rem; font-size: 1rem; border-radius: 8px; border: 1px solid #c6c6c6; background: #fff; }
    button { margin-top: 1.1rem; padding: 0.7rem 1.05rem; font-size: 1rem; border-radius: 10px; border: 0; background: #0069d9; color: #fff; cursor: pointer; box-shadow: 0 3px 10px rgba(0, 105, 217, 0.2); }
    button:disabled { background: #9ab9e8; cursor: not-allowed; box-shadow: none; }
    ul { padding-left: 1.2rem; }
    .muted { color: #555; }
    .hint { font-size: 0.95rem; margin-top: 0.6rem; color: #333; }
    .stack { display: grid; gap: 0.75rem; margin-top: 1.2rem; }
    .badge { display: inline-block; padding: 0.2rem 0.45rem; border-radius: 6px; background: #eef2ff; color: #223; font-size: 0.85rem; margin-left: 0.35rem; }
  </style>
</head>
<body>
  <div class="card">
    <h1>在留期間更新に必要な書類</h1>
    <p class="muted">身分・状況・奨学金区分を選ぶと、提出が必要な書類が表示されます。<br>
    前回在留期間更新をしてから今までの身分・状況・奨学金について選択してください。
    </p>

    <label for="status">現在の身分</label>
    <select id="status">
      <option value="">選択してください</option>
    </select>

    <label for="scenario">状況</label>
    <div id="scenario-container" class="stack">
      <select id="scenario" disabled>
        <option value="">身分を先に選んでください</option>
      </select>
    </div>

    <label for="scholarship">奨学金区分（任意）<span class="badge">任意</span></label>
    <select id="scholarship">
      <option value="">選択なし</option>
    </select>

    <label for="scholarship-status">奨学金の状況（任意）<span class="badge">任意</span></label>
    <select id="scholarship-status" disabled>
      <option value="">奨学金区分を先に選んでください</option>
    </select>

    <div class="hint">奨学金区分を選ぶと、該当する書類が追加で表示されます。</div>

    <button id="show" disabled>必要書類を表示</button>

    <div id="results" style="margin-top: 1.4rem;"></div>
  </div>

  <script>
    const COMMON_REQUIREMENTS = [
      "在留期間更新許可申請書（申請人等作成用の3枚 + 所属機関等作成用の2枚）",
      "提出書類一覧表、各種類確認書（両方提出必須。2025年1月申請分から提出が必須）",
      "パスポート、在留カード（原本を持参・提示してください）",
      "6,000円分の収入印紙",
    ];

    const STATUS_RULES = {
      "正規生": [
        {
          label: "前学期も同じ身分で正規生として在籍",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行機で発行）",
          ],
        },
                {
          label: "前学期とは異なる身分で正規生として在籍（学部生→修士、修士→博士等）",
          requirements: [
            "成績証明書（証明書自動発行機で発行）",
            "在学証明書（証明書自動発行機で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、研究生として在籍",
          requirements: [
            "在学証明書（証明書自動発行機で発行）",
            "外国人研究生証明書(別紙様式５)（旧所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在籍証明書（証明書自動発行機で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
      ],
      "研究生": [
        {
          label: "前学期も研究生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
          ],
        },
        {
          label: "前学期、日本語学校に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（日本語学校が発行）",
            "出席・卒業証明書（日本語学校が発行）",
          ],
        },
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、3+1特別聴講生(C)として在籍（9月で在留期限が切れる場合）",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（3+1プログラムの成績）",
          ],
        },
        {
          label: "前学期、正規生として在籍",
          requirements: [
            "外国人研究生証明書(別紙様式５)（所属の支援室で発行）",
            "成績証明書（旧所属の支援室で発行）",
            "修了証明書（旧所属の支援室で発行）",
          ],
        },
      ],
      "特別聴講学生": [
        {
          label: "前学期、他大学に在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（他大学が発行）",
            "卒業証明書（他大学が発行）",
          ],
        },
        {
          label: "前学期、本学の特別聴講生として在籍",
          requirements: [
            "在学証明書（所属の支援室で発行）",
            "成績証明書（所属の支援室で発行）",
          ],
        },
      ],
    };

    const SCHOLARSHIP_RULES = {
      "国費留学生": ["日本政府奨学金受給証明書（留学交流グループで発行）"],
      "日韓共同理工系学部留学生": ["日韓共同理工系学部留学生奨学金証明書（留学交流グループで発行）"],
      "日本政府以外の奨学金受給学生": ["RULE"],
    };

    const statusSelect = document.getElementById('status');
    const scenarioContainer = document.getElementById('scenario-container');
    const scholarshipSelect = document.getElementById('scholarship');
    const scholarshipStatusSelect = document.getElementById('scholarship-status');
    const showButton = document.getElementById('show');
    const results = document.getElementById('results');

    function populateStatuses() {
      Object.keys(STATUS_RULES).forEach((status) => {
        const option = document.createElement('option');
        option.value = status;
        option.textContent = status;
        statusSelect.appendChild(option);
      });
    }

    function populateScholarships() {
      Object.keys(SCHOLARSHIP_RULES).forEach((key) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        scholarshipSelect.appendChild(option);
      });
    }

    function populateScholarshipStatuses() {
      ['継続して受給', '新たに受給', '受給終了予定', '申請中'].forEach((status) => {
        const option = document.createElement('option');
        option.value = status;
        option.textContent = status;
        scholarshipStatusSelect.appendChild(option);
      });
    }

    function renderScenarioPlaceholder() {
      scenarioContainer.innerHTML = '';
      const select = document.createElement('select');
      select.disabled = true;
      const option = document.createElement('option');
      option.value = '';
      option.textContent = '身分を先に選んでください';
      select.appendChild(option);
      scenarioContainer.appendChild(select);
      showButton.disabled = true;
    }

    function addScenarioSelect(options, placeholder, preselected = '') {
      const select = document.createElement('select');
      const emptyOption = document.createElement('option');
      emptyOption.value = '';
      emptyOption.textContent = placeholder;
      select.appendChild(emptyOption);

      options.forEach((label) => {
        const option = document.createElement('option');
        option.value = label;
        option.textContent = label;
        select.appendChild(option);
      });

      if (preselected && options.includes(preselected)) {
        select.value = preselected;
      }

      select.addEventListener('change', syncScenarioSelects);
      scenarioContainer.appendChild(select);
    }

    function getScenarioOptionsForStatus(status) {
      return STATUS_RULES[status]?.map((item) => item.label) || [];
    }

    function syncScenarioSelects() {
      const status = statusSelect.value;
      if (!status) {
        renderScenarioPlaceholder();
        return;
      }

      const allOptions = getScenarioOptionsForStatus(status);
      const selectedValues = Array.from(
        scenarioContainer.querySelectorAll('select')
      )
        .map((select) => select.value)
        .filter((value) => value && allOptions.includes(value));

      const uniqueSelections = [];
      selectedValues.forEach((value) => {
        if (!uniqueSelections.includes(value)) {
          uniqueSelections.push(value);
        }
      });

      scenarioContainer.innerHTML = '';
      let remainingOptions = [...allOptions];

      uniqueSelections.forEach((selected, index) => {
        addScenarioSelect(
          remainingOptions,
          index === 0 ? '状況を選択してください' : '追加で選択（任意）',
          selected
        );
        remainingOptions = remainingOptions.filter((option) => option !== selected);
      });

      if (remainingOptions.length) {
        addScenarioSelect(
          remainingOptions,
          uniqueSelections.length === 0
            ? '状況を選択してください'
            : '追加で選択（任意）'
        );
      }

      showButton.disabled = uniqueSelections.length === 0;
      showRequirements();
    }

    function renderRequirements(requirements, scholarshipStatus) {
      results.innerHTML = '';
      if (!requirements.length) {
        const empty = document.createElement('p');
        empty.textContent = '必要な書類はありません。';
        results.appendChild(empty);
      } else {
        const list = document.createElement('ul');
        requirements.forEach((item) => {
          const li = document.createElement('li');
          li.textContent = item;
          list.appendChild(li);
        });
        results.appendChild(list);
      }

      if (scholarshipStatus) {
        const statusNote = document.createElement('p');
        statusNote.className = 'muted';
        statusNote.textContent = `奨学金の状況: ${scholarshipStatus}`;
        results.appendChild(statusNote);
      }
    }

    function showRequirements() {
      const status = statusSelect.value;
      const scholarship = scholarshipSelect.value;
      const scholarshipStatus = scholarshipStatusSelect.value;
      const selectedScenarios = Array.from(
        scenarioContainer.querySelectorAll('select')
      )
        .map((select) => select.value)
        .filter(Boolean);

      if (!status || !selectedScenarios.length) {
        renderRequirements([], scholarshipStatus);
        return;
      }

      const requirementSet = new Set(COMMON_REQUIREMENTS);
      selectedScenarios.forEach((scenarioLabel) => {
        const scenario = STATUS_RULES[status].find(
          (item) => item.label === scenarioLabel
        );
        (scenario?.requirements || []).forEach((item) => requirementSet.add(item));
      });

      if (scholarship) {
        (SCHOLARSHIP_RULES[scholarship] || []).forEach((item) =>
          requirementSet.add(item)
        );
      }

      renderRequirements([...requirementSet], scholarshipStatus);
    }

    statusSelect.addEventListener('change', () => {
      syncScenarioSelects();
      showRequirements();
    });

    scholarshipSelect.addEventListener('change', () => {
      if (!scholarshipSelect.value) {
        scholarshipStatusSelect.value = '';
        scholarshipStatusSelect.disabled = true;
        scholarshipStatusSelect.options[0].textContent =
          '奨学金区分を先に選んでください';
      } else {
        scholarshipStatusSelect.disabled = false;
        scholarshipStatusSelect.options[0].textContent =
          '奨学金の状況を選択してください';
      }
      showRequirements();
    });

    scholarshipStatusSelect.addEventListener('change', showRequirements);
    showButton.addEventListener('click', showRequirements);

    populateStatuses();
    populateScholarships();
    populateScholarshipStatuses();
    renderScenarioPlaceholder();
  </script>
</body>
</html>
